<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck POS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        #pos-container {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            gap: 20px; /* Space between sections */
            flex-wrap: wrap; /* Allow wrapping to the next line if not enough space */
        }

        #menu, #basket, #payment {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        #menu {
            flex: 2; /* Take up more space */
            min-width: 300px; /* Minimum width for the menu */
        }

        #basket, #payment {
            flex: 1; /* Take up less space */
            min-width: 250px; /* Minimum width for basket and payment */
        }

        .menu-section {
            margin-bottom: 20px;
        }

        button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 18px;
        }

        #basket-items {
            list-style-type: none;
            padding: 0;
        }

        #basket-items li {
            margin-bottom: 5px;
        }

        #total-to-pay, #change-amount {
            font-weight: bold;
            font-size: 1.2em;
        }

        #change-amount {
            color: #4CAF50;
        }

        @media (max-width: 768px) {
            #pos-container {
                flex-direction: column;
            }
            
            #menu, #basket, #payment {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="pos-container">
        <div id="menu">
            <h2>Menu</h2>
            <div class="menu-section">
                <h3>Plats Principaux</h3>
                <button class="menu-item" data-name="Poulet grillé sauce cacahuète" data-price="18">Poulet grillé sauce cacahuète - 18 CHF</button>
                <button class="menu-item" data-name="Poulet grillé sauce Yassa" data-price="18">Poulet grillé sauce Yassa - 18 CHF</button>
                <button class="menu-item" data-name="Bœuf au curry rouge" data-price="18">Bœuf au curry rouge - 18 CHF</button>
            </div>
            <div class="menu-section">
                <h3>Accompagnements</h3>
                <button class="menu-item" data-name="Samossas" data-price="3">Samossas - 3 CHF</button>
                <button class="menu-item" data-name="Chapatis" data-price="3">Chapatis - 3 CHF</button>
                <button class="menu-item" data-name="Bananes plantains frites" data-price="5">Bananes plantains frites - 5 CHF</button>
            </div>
            <div class="menu-section">
                <h3>Boissons</h3>
                <button class="menu-item" data-name="Jus de Gingembre" data-price="4">Jus de Gingembre - 4 CHF</button>
                <button class="menu-item" data-name="Jus de Bissap" data-price="4">Jus de Bissap - 4 CHF</button>
                <button class="menu-item" data-name="Eaux minérales" data-price="3">Eaux minérales - 3 CHF</button>
            </div>
            <div class="menu-section">
                <h3>Desserts</h3>
                <button class="menu-item" data-name="Mandazi" data-price="5">Mandazi - 5 CHF</button>
                <button class="menu-item" data-name="Kashata or Basbusa" data-price="2">Kashata or Basbusa - 2 CHF</button>
            </div>
        </div>
        <div id="basket">
            <h2>Panier</h2>
            <ul id="basket-items"></ul>
            <p>Total: <span id="total">0</span> CHF</p>
        </div>
        <div id="payment">
            <h2>Paiement</h2>
            <p>Total à payer: <span id="total-to-pay">0</span> CHF</p>
            <input type="number" id="custom-amount" placeholder="Montant personnalisé">
            <button class="pay-button" data-amount="10">10 CHF</button>
            <button class="pay-button" data-amount="20">20 CHF</button>
            <button class="pay-button" data-amount="50">50 CHF</button>
            <button class="pay-button" data-amount="100">100 CHF</button>
            <p>Monnaie à rendre: <span id="change-amount">0</span> CHF</p>
            <button id="pay-custom">Payer</button>
        </div>
    </div>
    <script>
        console.log("Script loaded");

        // Initialize the basket and total
        let basket = [];
        let total = 0;

        // Function to add item to basket
        function addToBasket(name, price) {
            console.log(`Adding to basket: ${name} - ${price} CHF`);
            let item = basket.find(i => i.name === name);
            if (item) {
                item.quantity++;
            } else {
                basket.push({name: name, price: price, quantity: 1});
            }
            console.log("Basket after adding item:", basket);
            updateBasket();
        }

        // Function to update the basket display
        function updateBasket() {
            console.log("Updating basket");
            let basketElement = document.getElementById('basket-items');
            basketElement.innerHTML = '';
            total = 0;
            basket.forEach(item => {
                let li = document.createElement('li');
                li.textContent = `${item.name} x${item.quantity} - ${item.price * item.quantity} CHF`;
                basketElement.appendChild(li);
                total += item.price * item.quantity;
            });
            document.getElementById('total').textContent = total;
            document.getElementById('total-to-pay').textContent = total;
            updateChangeAmount();
        }

        // Function to update change amount
        function updateChangeAmount() {
            let paymentAmount = parseFloat(document.getElementById('custom-amount').value) || 0;
            let changeAmount = paymentAmount - total;
            document.getElementById('change-amount').textContent = changeAmount > 0 ? changeAmount.toFixed(2) : '0';
        }

        // Function to handle payment
        function handlePayment(amount) {
            console.log(`Handling payment: ${amount} CHF`);
            if (amount >= total) {
                let change = amount - total;
                console.log(`Change to be returned: ${change} CHF`);
                document.getElementById('change-amount').textContent = change.toFixed(2);
                // Log the transaction
                let transaction = {
                    items: basket,
                    total: total,
                    date: new Date().toISOString()
                };
                logTransactionToIFTTT(total); // Add this line to send the total amount to IFTTT
                // Reset the basket
                basket = [];
                updateBasket();
                // Reset the custom amount input
                document.getElementById('custom-amount').value = '';
                updateChangeAmount();
            } else {
                alert('Montant insuffisant!');
            }
        }

        // Function to log transaction to IFTTT
        async function logTransactionToIFTTT(totalAmount) {
            const event = 'POS'; // Replace with your IFTTT event name
            const key = 'x5Jhxl9evk6SPmKe8rW5S'; // Replace with your IFTTT Webhook key

            const response = await fetch(`https://maker.ifttt.com/trigger/${event}/with/key/${key}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    value1: totalAmount.toFixed(2),
                    value2: new Date().toISOString(),
                    value3: 'CHF'
                })
            });

            if (response.ok) {
                console.log('Transaction logged to IFTTT');
            } else {
                console.error('Failed to log transaction to IFTTT');
            }
        }

        // Add event listeners when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', (event) => {
            console.log("DOM fully loaded and parsed");

            // Add event listeners to menu items
            document.querySelectorAll('.menu-item').forEach(button => {
                button.addEventListener('click', function() {
                    let name = this.getAttribute('data-name');
                    let price = parseFloat(this.getAttribute('data-price'));
                    addToBasket(name, price);
                });
            });

            // Add event listeners to payment buttons
            document.querySelectorAll('.pay-button').forEach(button => {
                button.addEventListener('click', function() {
                    let amount = parseFloat(this.getAttribute('data-amount'));
                    document.getElementById('custom-amount').value = amount;
                    updateChangeAmount();
                    handlePayment(amount); // Automatically handle payment without confirmation
                });
            });

            // Add event listener to custom amount input
            document.getElementById('custom-amount').addEventListener('input', updateChangeAmount);

            // Add event listener to custom payment button
            document.getElementById('pay-custom').addEventListener('click', function() {
                let amount = parseFloat(document.getElementById('custom-amount').value);
                if (isNaN(amount)) {
                    alert('Veuillez entrer un montant valide');
                } else {
                    handlePayment(amount);
                }
            });
        });

        console.log("Script execution completed");
    </script>
</body>
</html>
